const a=document.body.querySelector("canvas");a.width=window.innerWidth,a.height=window.innerHeight;const o=a.getContext("2d"),w="#9CA3AF",P="#EC4899";let y=null,m=null;class X{constructor(c,e){this.start=c,this.end=e,this.uid=A()}}const r=[];let d=[];function g(n,c,e,t){const i=(n+e)/2;if(o.beginPath(),o.moveTo(n,c),Math.abs(c-t)>=16&&Math.abs(n-e)>=16){const s=t>=c?-8:8,l=e<=n?8:-8;o.lineTo(i+l,c),o.arcTo(i,c,i,c+s*-1,8),o.lineTo(i,t+s),o.arcTo(i,t,i+l*-1,t,8),o.lineTo(e,t)}else o.lineTo(i,c),o.lineTo(i,t),o.lineTo(e,t);o.stroke()}let x=performance.now();function L(){const n=performance.now(),c=(n-x)/1e3;if(x=n,d=[],o.clearRect(0,0,a.width,a.height),y!==null){o.strokeStyle=w;const{x:e,y:t}=y,{x:i,y:s}=m;g(e,t,i,s)}for(let e=0;e<r.length;e++){const{x:t,y:i}=m,{x:s,y:l}=r[e].start,{x:u,y:h}=r[e].end,T=s<=u?s:u,b=l<=h?l:h,v=s>=u?s:u,E=l>=h?l:h;if(t>=T&&t<=v&&i>=b&&i<=E){const f=(s+u)/2,p=s<=u?-1:1;t>=f-8&&t<=f+8?d.push(r[e].uid):i>=l-8&&i<=l+8?p===-1?t<=f&&d.push(r[e].uid):t>=f&&d.push(r[e].uid):i>=h-8&&i<=h+8&&(p===-1?t>=f&&d.push(r[e].uid):t<=f&&d.push(r[e].uid))}}for(let e=0;e<r.length;e++){const t=r[e],{x:i,y:s}=t.start,{x:l,y:u}=t.end;d.includes(t.uid)?o.strokeStyle=P:o.strokeStyle=w,g(i,s,l,u)}window.requestAnimationFrame(L)}L(),a.addEventListener("mousemove",n=>{m={x:n.clientX,y:n.clientY}},{capture:!0}),a.addEventListener("mousedown",n=>{y={x:n.clientX,y:n.clientY}}),a.addEventListener("mouseup",n=>{const c=new X(y,{x:n.clientX,y:n.clientY});r.push(c),y=null},{capture:!0});function A(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,n=>(n^crypto.getRandomValues(new Uint8Array(1))[0]&15>>n/4).toString(16))}
